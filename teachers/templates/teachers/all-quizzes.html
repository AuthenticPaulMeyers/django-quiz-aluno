{% extends 'teachers/partials/base.html' %}

{% load widget_tweaks %}

{% load static %}

{% block content %}
  <div class="flex flex-col min-h-screen">
    {% include 'teachers/partials/header.html' %}
    <main class="flex-grow container mx-auto px-4 sm:px-6 lg:px-8 py-8">

      <div class="flex flex-row justify-between">
        <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-8">
        <h2 class="text-3xl font-bold dark:text-background-light text-gray-700">
          All Quizzes
        </h2>
        <div class="text-center">

        <a href="{% url 'teachers:create-quiz' %}">
            <button
            class="flex items-center justify-center gap-2 px-4 py-2 bg-primary text-white rounded-lg shadow-sm hover:bg-primary/90 transition-colors">
                <span class="material-symbols-outlined">add_circle</span>
                <span>Create Quiz</span>
            </button>
        </a>
      </div>
      </div>

      <div class="flex flex-row flex-wrap gap-2 mb-8 text-center align-center justify-center">
        <button data-filter="all"
          class="js-filter-btn flex items-center gap-1 px-4 py-2 rounded-lg bg-primary text-white text-sm font-medium transition-colors" aria-pressed="true">
          <span>All</span>
        </button>
        <button data-filter="active"
          class="js-filter-btn flex items-center gap-1 px-4 py-2 rounded-lg bg-background-light dark:bg-background-dark border border-background-dark/10 dark:border-background-light/10 text-background-dark/80 dark:text-background-light/80 hover:bg-primary/10 dark:hover:bg-primary/20 text-sm font-medium transition-colors">
          <span>Active</span>
        </button>
        <button data-filter="expired"
          class="js-filter-btn flex items-center gap-1 px-4 py-2 rounded-lg bg-background-light dark:bg-background-dark border border-background-dark/10 dark:border-background-light/10 text-background-dark/80 dark:text-background-light/80 hover:bg-primary/10 dark:hover:bg-primary/20 text-sm font-medium transition-colors">
          <span>Expired</span>
        </button>
        <button data-filter="upcoming"
          class="js-filter-btn flex items-center gap-1 px-4 py-2 rounded-lg bg-background-light dark:bg-background-dark border border-background-dark/10 dark:border-background-light/10 text-background-dark/80 dark:text-background-light/80 hover:bg-primary/10 dark:hover:bg-primary/20 text-sm font-medium transition-colors">
          <span>Upcoming</span>
        </button>
      </div>
      </div>
    {% if quizzes %}
      <div
        class="bg-background-light dark:bg-background-dark/80 rounded-xl overflow-hidden border border-background-dark/10 dark:border-background-light/10">
        <div class="overflow-x-auto">

          <table class="w-full text-sm text-left text-background-dark/80 dark:text-background-light/80">
            <thead
              class="text-xs uppercase bg-background-light dark:bg-background-dark border-b border-background-dark/10 dark:border-background-light/10">
              <tr>
                <th class="px-6 py-3 font-medium" scope="col">Quiz Title</th>
                <th class="px-6 py-3 font-medium" scope="col">Subject</th>
                <th class="px-6 py-3 font-medium" scope="col">Time allowed</th>
                <th class="px-6 py-3 font-medium text-center" scope="col">
                  Status
                </th>
                <th class="px-6 py-3 font-medium text-right" scope="col">
                  Actions
                </th>
              </tr>
            </thead>
            
            <tbody>
              {% for quiz in quizzes %}
              <tr
                data-status="{% if quiz.due_date < current_time %}expired{% elif quiz.start_date > current_time %}upcoming{% else %}active{% endif %}"
                class="border-b border-background-dark/10 dark:border-background-light/10 hover:bg-primary/5 dark:hover:bg-primary/10">
                <td class="px-6 py-4">{{ quiz.title }}</td>
                <td class="px-6 py-4">{{ quiz.subject.name }}</td>
                <td class="px-6 py-4">{{ quiz.duration }} mins</td>
                <td class="px-6 py-4 text-center">
                  
                {% if quiz.due_date < current_time %}
                  <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-200 text-red-500">Expired</span>
                {% elif quiz.start_date > current_time %}
                  <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-200 text-blue-500">Upcoming</span>
                {% elif quiz.start_date <= current_time and current_time <= quiz.due_date %}
                  <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-200 text-green-500">Active</span>
                {% endif %}
                </td>
                <td class="px-6 py-4 text-right space-x-2">
                  <a class="font-medium text-primary hover:underline" href="{% url 'teachers:quiz-details' quiz.id %}">View</a>
                  <a class="font-medium text-red-600 hover:underline" href="{% url 'teachers:delete-quiz' quiz.id %}">Delete</a>
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
          
        </div>
      </div>
        {% else %}
          <span class="text-center px-2 py-4 text-sm font-gray-400">You do not have any quiz.</span>
        {% endif %}
          <script src="{% static 'js/all-quizzes.js' %}" defer></script>
    </main>
  </div>
{% endblock %}