

{% extends 'teachers/partials/base.html' %}

{% load widget_tweaks %}
{% load static %}
{% load quiz_extras %}

{% block content %}
<div class="flex flex-col min-h-screen">
	{% include 'teachers/partials/header.html' %}
	<main class="flex-grow container mx-auto px-4 sm:px-6 lg:px-8 py-8">
		<div class="max-w-4xl mx-auto space-y-6">
			<div class="flex items-center justify-between">
				<h2 class="text-2xl font-bold">Quiz Details</h2>
				<form method="post" style="display:inline">
					{% csrf_token %}
					<input type="hidden" name="action" value="delete_quiz" />
					<button type="submit" class="inline-flex items-center gap-2 px-3 py-2 bg-red-600 text-white rounded hover:bg-red-700">Delete Quiz</button>
				</form>
			</div>

			<!-- Quiz metadata edit -->
			<div class="rounded-lg border border-border-light p-6 bg-background-light">
				<form method="post">
					{% csrf_token %}
					<input type="hidden" name="action" value="save_quiz" />
					<div class="grid grid-cols-1 md:grid-cols-2 gap-4">
						<div>
							<label class="block text-sm font-medium">Title</label>
							{{ quiz_form.title|add_class:"mt-1 block w-full rounded border-border-light bg-white" }}
						</div>
						<div>
							<label class="block text-sm font-medium">Duration (mins)</label>
							{{ quiz_form.duration|add_class:"mt-1 block w-full rounded border-border-light bg-white" }}
						</div>
						<div class="md:col-span-2">
							<label class="block text-sm font-medium">Description</label>
							{{ quiz_form.description|add_class:"mt-1 block w-full rounded border-border-light bg-white" }}
						</div>
						<div>
							<label class="block text-sm font-medium">Start Date</label>
							{{ quiz_form.start_date|add_class:"mt-1 block w-full rounded border-border-light bg-white" }}
						</div>
						<div>
							<label class="block text-sm font-medium">Due Date</label>
							{{ quiz_form.due_date|add_class:"mt-1 block w-full rounded border-border-light bg-white" }}
						</div>
					</div>
					<div class="mt-4 flex gap-2">
						<button type="submit" class="px-4 py-2 bg-primary text-white rounded">Save Quiz</button>
					</div>
				</form>
			</div>

			<!-- Questions list -->
			<div class="space-y-4">
				<div class="flex items-center justify-between">
					<h3 class="text-lg font-semibold">Questions ({{ questions.count }})</h3>
					<form method="post" class="flex items-center gap-2">
						{% csrf_token %}
						<input type="hidden" name="action" value="add_question" />
						<input type="text" name="new_question_text" placeholder="New question text (optional)" class="px-2 py-1 border rounded" />
						<button type="submit" class="px-3 py-1 bg-green-600 text-white rounded">Add Question</button>
					</form>
				</div>

				{% for question in questions %}
				<div class="rounded-lg border bg-white p-4">
					<form method="post">
						{% csrf_token %}
						<input type="hidden" name="action" value="save_question" />
						<input type="hidden" name="question_id" value="{{ question.id }}" />
						<div class="mb-3">
							<label class="block text-sm font-medium">Question {{ forloop.counter }}</label>
							<textarea name="question_text_{{ question.id }}" rows="2" class="w-full mt-1 p-2 border rounded">{{ question.question_text }}</textarea>
						</div>

						<div class="grid grid-cols-1 md:grid-cols-2 gap-3">
							{% for choice in choices_map|get_item:question.id %}
							<div class="flex items-center gap-2">
								<input type="text" name="choice_text_{{ choice.id }}" value="{{ choice.choice_text }}" class="flex-1 px-2 py-1 border rounded" />
								<label class="flex items-center gap-1">
									<input type="checkbox" name="is_correct_{{ choice.id }}" {% if choice.is_correct %}checked{% endif %} />
									<span class="text-sm">Correct</span>
								</label>
							</div>
							{% endfor %}
						</div>

						<div class="mt-3 flex gap-2">
							<button type="submit" class="px-3 py-1 bg-primary text-white rounded">Save Question</button>
					</form>
					<form method="post" class="ml-2">
						{% csrf_token %}
						<input type="hidden" name="action" value="delete_question" />
						<input type="hidden" name="question_id" value="{{ question.id }}" />
						<button type="submit" class="px-3 py-1 bg-red-600 text-white rounded">Delete Question</button>
					</form>
						</div>
				</div>
				{% endfor %}
			</div>

		</div>
	</main>
</div>
{% endblock %}

{% comment %}
Helper template filter note: we use choices_map passed from the view; to index a dict by key in templates a simple get_item filter is helpful. If not present, Django will fallback to attribute lookup; if you need the filter, we can add it.
{% endcomment %}