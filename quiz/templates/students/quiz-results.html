{% extends 'students/base.html' %}

{% load static %}

{% block content %}
  <div class="flex flex-col min-h-screen">
    {% include 'students/partials/student-header.html' %}
    <main class="flex-grow container mx-auto px-4 sm:px-6 lg:px-8 py-8 lg:py-12">
      <div class="max-w-4xl mx-auto">
        <div class="mb-8">
          <h2 class="text-3xl font-bold tracking-tight text-gray-700 dark:text-foreground-dark">
            Quiz Results
          </h2>
          <p class="mt-2 text-lg text-subtle-light dark:text-subtle-dark">
            Here's your performance on the recent quiz.
          </p>
          <!-- Display error messages if any -->
          {% if messages %}
            {% for message in messages %}
                <p class="text-center text-sm text-red-600 mb-4 mt-4">{{ message }}</p>
            {% endfor %}
          {% endif %}
        </div>
        <div class="grid grid-cols-1 sm:grid-cols-3 gap-6 mb-12">
          <div
            class="bg-white dark:bg-background-dark/70 p-6 rounded-xl border border-border-light dark:border-border-dark">
            <p class="text-sm font-medium text-subtle-light dark:text-subtle-dark">
              Score
            </p>
            <p class="text-4xl font-bold text-primary mt-2">{{ score }}</p>
            <span class="text-sm font-medium text-subtle-light dark:text-subtle-dark">{{ score|floatformat:0|add:'0' }}%</span>
          </div>
          <div
            class="bg-white dark:bg-background-dark/70 p-6 rounded-xl border border-border-light dark:border-border-dark">
            <p class="text-sm font-medium text-subtle-light dark:text-subtle-dark">
              Correct Answers
            </p>
            <p class="text-4xl font-bold text-gray-700 dark:text-foreground-dark mt-2">
              {{ correct_count }}/{{ total }}
            </p>
          </div>
          <div
            class="bg-white dark:bg-background-dark/70 p-6 rounded-xl border border-border-light dark:border-border-dark">
            <p class="text-sm font-medium text-subtle-light dark:text-subtle-dark">
              Time Taken
            </p>
            <p class="text-4xl font-bold text-gray-700 dark:text-foreground-dark mt-2">
              {{ time_taken|default:'N/A' }}
            </p>
          </div>
        </div>
        <div>
          <h3 class="text-2xl font-bold text-gray-700 dark:text-foreground-dark mb-6">
            Answer Review
          </h3>
          <div class="space-y-4">
            {% for a in answers_review %}
            <div
              class="flex items-start gap-4 p-4 bg-white dark:bg-background-dark/70 rounded-lg border border-border-light dark:border-border-dark">
              {% if a.is_correct %}
              <div class="flex-shrink-0 size-10 rounded-full flex items-center justify-center bg-green-200 text-green-900">
                <span class="fa-solid fa-check"></span>
              </div>
              {% else %}
              <div class="flex-shrink-0 size-10 rounded-full flex items-center justify-center bg-red-200 text-red-900">
                <span class="fa-solid fa-xmark"></span>
              </div>
              {% endif %}
              <div class="flex-grow">
                <p class="font-medium text-gray-700 dark:text-foreground-dark">
                  {{ forloop.counter }}. {{ a.question }}
                </p>
                <p class="text-sm text-subtle-light dark:text-subtle-dark">
                  <b>Your answer:</b> {{ a.your_answer|default:'No answer' }}
                </p>
                {% if not a.is_correct %}
                <p class="text-sm text-subtle-light dark:text-subtle-dark">
                  <b>Correct answer:</b> {{ a.correct_answer|default:'-' }}
                </p>
                {% endif %}
              </div>
            </div>
            {% endfor %}

          <div class="mt-12 text-center">
            <button
              class="bg-primary text-white font-medium px-4 py-3 rounded-full hover:bg-primary/90 transition-all duration-300">
              <a href="{% url 'quiz:student-dashboard' %}">Back to Dashboard</a>
            </button>
          </div>
        </div>
      </div>
    </main>
  </div>
{% endblock %}