{% extends 'students/base.html' %}

{% load static %}

{% block content %}
  <div class="flex flex-col min-h-screen">
    {% include 'students/partials/student-header.html' %}
    <main class="flex-grow container mx-auto px-4 sm:px-6 lg:px-8 py-8 lg:py-12">
      <div class="max-w-4xl mx-auto">
        <div class="mb-8">
          <h2 class="text-3xl font-bold tracking-tight text-gray-700 dark:text-foreground-dark">
            Exam Results
          </h2>
          <p class="mt-2 text-lg text-subtle-light dark:text-subtle-dark">
            Here's your performance on the recent exam.
          </p>
        </div>
        <div class="grid grid-cols-1 sm:grid-cols-3 gap-6 mb-12">
          <div
            class="bg-white dark:bg-background-dark/70 p-6 rounded-xl border border-border-light dark:border-border-dark">
            <p class="text-sm font-medium text-subtle-light dark:text-subtle-dark">
              Score
            </p>
            <p class="text-4xl font-bold text-gray-700 mt-2">{{ score }}%</p>
            {% if score|floatformat:0|add:'0' < 40 %}
            <span class="text-sm font-medium text-red-600 dark:text-red-600">FAILED</span>
            {% else %}
            <span class="text-sm font-medium text-green-600 dark:text-green-600">PASSED</span>
            {% endif %}
          </div>
          <div
            class="bg-white dark:bg-background-dark/70 p-6 rounded-xl border border-border-light dark:border-border-dark">
            <p class="text-sm font-medium text-subtle-light dark:text-subtle-dark">
              Correct Answers
            </p>
            <p class="text-4xl font-bold text-gray-700 dark:text-foreground-dark mt-2">
              {{ correct_count }}/{{ total }}
            </p>
          </div>
          <div
            class="bg-white dark:bg-background-dark/70 p-6 rounded-xl border border-border-light dark:border-border-dark">
            <p class="text-sm font-medium text-subtle-light dark:text-subtle-dark">
              Grade
            </p>
            <p class="text-4xl font-bold text-gray-700 dark:text-foreground-dark mt-2">
              {{ grade }}
            </p>
          </div>
          <!-- <div
            class="bg-white dark:bg-background-dark/70 p-6 rounded-xl border border-border-light dark:border-border-dark">
            <p class="text-sm font-medium text-subtle-light dark:text-subtle-dark">
              Time Taken
            </p>
            <p class="text-4xl font-bold text-gray-700 dark:text-foreground-dark mt-2">
              {{ time_taken|default:'N/A' }}
            </p>
          </div> -->
        </div>
        <div>
          <h3 class="text-2xl font-bold text-gray-700 dark:text-foreground-dark mb-6">
            Answer Review
          </h3>
          <div class="space-y-4">
            {% for a in answers_review %}
            <div
              class="flex items-start gap-4 p-4 bg-white dark:bg-background-dark/70 rounded-lg border border-border-light dark:border-border-dark">
              {% if a.is_correct %}
              <div class="flex-shrink-0 size-10 rounded-full flex items-center justify-center bg-green-200 text-green-900">
                <span class="fa-solid fa-check"></span>
              </div>
              {% else %}
              <div class="flex-shrink-0 size-10 rounded-full flex items-center justify-center bg-red-200 text-red-900">
                <span class="fa-solid fa-xmark"></span>
              </div>
              {% endif %}
              <div class="flex-grow">
                <p class="font-medium text-gray-700 dark:text-foreground-dark no-copy">
                  {{ forloop.counter }}. {{ a.question }}
                </p>

                {% if not a.is_correct %}
                <p class="text-sm text-subtle-light dark:text-subtle-dark">
                  <b>Your answer:</b> <span class="line-through no-copy">{{ a.your_answer|default:'No answer' }}</span>
                </p>
                <p class="text-sm text-subtle-light dark:text-subtle-dark">
                  <b>Correct answer:</b> {{ a.correct_answer|default:'-' }}
                </p>
                {% else %}
                <p class="text-sm text-subtle-light dark:text-subtle-dark">
                  <b>Your answer:</b> <span class="no-copy">{{ a.your_answer|default:'No answer' }}</span>
                </p>
                {% endif %}
              </div>
            </div>
            {% endfor %}
          <div class="mt-12 text-center">
            <form action="{% url 'quiz:student-dashboard' %}" method="POST">
              {% csrf_token %}
              <button id="home-btn" class="group relative flex justify-center align-center text-center items-center py-3 m-4 px-4 border border-transparent text-sm font-bold rounded-full text-white bg-primary hover:bg-opacity-90 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary transition-colors" type="submit">
                <i class="fa-solid fa-arrow-left"></i>
                <span class="px-2">Back to Dashboard</span>
                <svg id="loading-spinner" class="hidden animate-spin ml-2 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
              </button>
          </form>
          </div>
        </div>
      </div>
    </main>
  </div>
  <script >
    // Disable button when is clicked to avoid double clicking and overloading the server
  const form = document.querySelector("form");
  const btn = document.getElementById("home-btn");
  const spinner = document.getElementById("loading-spinner");

  form.addEventListener("submit", function () {
        btn.disabled = true;
        btn.classList.add("opacity-75", "cursor-not-allowed");
        spinner.classList.remove("hidden");
  });
  </script>
{% endblock %}